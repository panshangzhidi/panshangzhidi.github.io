<!DOCTYPE html>
<html>
<head>
  <title>Text Editor and Viewer</title>
  <style>
    .container {
      display: flex;
      justify-content: space-between;
    }
    #myTextarea {
      width: 60%;
    }
    table {
      width: 100%;
    }
    td {
      width: 50%;
    }
    .textviewer {
      display: flex;
      margin: 10px;
    }
    .preamble {
      margin-right: 10px;
    }
    #dropzone {
      width: 100%;
      height: 50px;
      border: 1px solid black;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>Text Editor</h2>
  <div class="container">
    <textarea id="myTextarea" rows="10"></textarea>
    <button onclick="removeNewlines()" title="换行符替换为空格">删除换行符</button>
  </div>

  <h2>Text Viewer</h2>
  <table>
    <tr>
      <td>
        <div class="textviewer" draggable="true" ondragstart="drag(event)" id="myDiv1">
          <div class="preamble">preamble</div>
          <button onclick="copyToClipboard('myDiv1')">Copy</button>
        </div>
      </td>
      <td>
        <div class="textviewer" draggable="true" ondragstart="drag(event)" id="myDiv2">
          <div class="preamble">preamble</div>
          <button onclick="copyToClipboard('myDiv2')">Copy</button>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="textviewer" draggable="true" ondragstart="drag(event)" id="myDiv3">
          <div class="preamble">preamble</div>
          <button onclick="copyToClipboard('myDiv3')">Copy</button>
        </div>
      </td>
      <td>
        <div class="textviewer" draggable="true" ondragstart="drag(event)" id="myDiv4">
          <div class="preamble">preamble</div>
          <button onclick="copyToClipboard('myDiv4')">Copy</button>
        </div>
      </td>
    </tr>
  </table>

  <div id="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

  <script>
    document.getElementById('myTextarea').addEventListener('input', function() {
      var textviewers = document.getElementsByClassName('textviewer');
      for (var i = 0; i < textviewers.length; i++) {
        textviewers[i].innerText = this.value;
      }
    });

    function copyToClipboard(id) {
      var preamble = document.querySelector('.preamble').innerText;
      var text = document.getElementById(id).innerText;
      var fullText = preamble + '\n' + text;

      var dummy = document.createElement('textarea');
      document.body.appendChild(dummy);
      dummy.value = fullText;
      dummy.select();
      document.execCommand('copy');
      document.body.removeChild(dummy);

      var copyAlert = document.createElement('span');
      copyAlert.innerText = ' Copied!';
      document.getElementById(id).after(copyAlert);
      setTimeout(function() {
        copyAlert.remove();
      }, 3000);
    }

    function removeNewlines() {
      var text = document.getElementById('myTextarea').value;
      var newText = text.replace(/(\r\n|\n|\r)/gm, " ");
      document.getElementById('myTextarea').value = newText;
    }

    function drag(ev) {
      ev.dataTransfer.setData("text", ev.target.id);
    }

    function drop(ev) {
      ev.preventDefault();
      var data = ev.dataTransfer.getData("text");
      ev.target.appendChild(document.getElementById(data));
    }

    function allowDrop(ev) {
      ev.preventDefault();
    }
  </script>
</body>
</html>
